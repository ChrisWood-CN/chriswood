import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as i,o as a,b as n}from"./app-C9ZAR9YT.js";const l={},e=n(`<h1 id="nginx常用操作及配置" tabindex="-1"><a class="header-anchor" href="#nginx常用操作及配置"><span>Nginx常用操作及配置</span></a></h1><h3 id="常用操作" tabindex="-1"><a class="header-anchor" href="#常用操作"><span>常用操作</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#强制停止Nginx</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">kill</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -9</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> quit</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="常见配置" tabindex="-1"><a class="header-anchor" href="#常见配置"><span>常见配置</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#指定运行worker进程的用户和组</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">user</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  nginx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#指定nginx守护进程的pid文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pid</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /path/to/pid_file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">worker_rlimit_nofile</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#设置所有worker进程最大可以打开的文件数，默认为1024</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">worker_rlimit_core</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#指明所有worker进程所能够使用的总体的最大核心文件大小，保持默认即可</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 启动n个worker进程，这里的n为了避免上下文切换，通常设置为cpu总核心数-1或等于总核心数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">worker_processes</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">worker_cpu_affinity</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> cpumask</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> …</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#将进程绑定到某cpu中，避免频繁刷新缓存</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#cpumask：使用8位二进制表示cpu核心，如：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#0000 0001 第一颗cpu核心</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#0000 0010 第二颗cpu核心</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#0000 0100 第三颗cpu核心</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#0000 1000 第四颗cpu核心</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#0001 0000 第五颗cpu核心</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#0010 0000 第六颗cpu核心</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#0100 0000 第七颗cpu核心</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#1000 0000 第八颗cpu核心</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">timer_resolution</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> interval</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#计时器解析度。降低此值，可减少gettimeofday()系统调用的次数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">worker_priority</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> number</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#指明worker进程的nice值</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">events</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  #master调度用户请求至各worker进程时使用的负载均衡锁；on表示能让多个worker轮流地、序列化地去响应新请求</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  accept_mutex</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {off</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on}</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  # 每个进程的最大连接数量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  worker_connections</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">http</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mime.types</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  default_type</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> application/octet-stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  sendfile</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  keepalive_timeout</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 65</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  # 演示如何强制http跳转https</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  server</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    listen</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 80</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    server_name</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> test.com</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # http强制跳转到https</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    rewrite</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ^</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)$ </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">https://</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$server_name</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">$1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> permanent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  # 演示如何配置微信支付的校验文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  server</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    listen</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 80</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    server_name</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> localhost</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # 默认根路径</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> index.html</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # 微信支付校验文件，可以直接配置访问名称</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ^~/MP_verify_2g3uEjrB5B2LIbNl.txt</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">      alias</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /home/MP_verify_2g3uEjrB5B2LIbNl.txt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # 微信支付校验文件，也可以通过正则配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ~^/MP_verify_[a-zA-Z0-9]</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\.</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">txt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)$ </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /home/</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      rewrite</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ^/home/</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">.txt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)$ </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/home/</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">$1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> last</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  # 演示root和alias两种配置静态资源的区别</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  server</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    listen</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 80</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    server_name</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> localhost</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # 用root方式，location中的路径会拼加到root的地址后面</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # 请求路径为：http://localhost:8080/files/index.jpg    实际访问为：/home/files/index.jpg</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ~^/files/</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /home/</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      index</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> index.html</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> index.htm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # 用alias方式，location中的路径不会拼加到alias的地址后面</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # 这请求路径为：http://localhost:8080/files/index.jpg    实际访问为：/home/index.jpg</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ~^/files/</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">      alias</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /home/</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      index</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> index.html</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> index.htm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  # 演示请求后台接口代理配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  server</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    listen</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    server_name</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> localhost</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    #################### 第一种场景 ####################</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # 请求路径为：http://127.0.0.1:8080/api/getUser   实际代理为：http://127.0.0.1:8000/api/getUser</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ^~/api/</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_pass</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> http://127.0.0.1:8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Host</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $http_host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#后台可以获取到完整的ip+端口号</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> X-Real-IP</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $remote_addr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#后台可以获取到用户访问的真实ip地址</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # 请求路径为：http://127.0.0.1:8080/api/getUser   实际指向为：http://127.0.0.1:8000/api/getUser</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ^~/api</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_pass</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> http://127.0.0.1:8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Host</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $http_host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#后台可以获取到完整的ip+端口号</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> X-Real-IP</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $remote_addr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#后台可以获取到用户访问的真实ip地址</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    #################### 第二种场景 ####################</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # 请求路径为：http://127.0.0.1:8080/api/getUser   实际代理为：http://127.0.0.1:8000/getUser</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ^~/api/</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_pass</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> http://127.0.0.1:8000/</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Host</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $http_host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#后台可以获取到完整的ip+端口号</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> X-Real-IP</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $remote_addr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#后台可以获取到用户访问的真实ip地址</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # 请求路径为：http://127.0.0.1:8080/api/getUser   实际代理为：http://127.0.0.1:8000//getUser</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ^~/api</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_pass</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> http://127.0.0.1:8000/</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Host</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $http_host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#后台可以获取到完整的ip+端口号</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> X-Real-IP</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $remote_addr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#后台可以获取到用户访问的真实ip地址</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    #################### 第三种场景 ####################</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # 请求路径为：http://127.0.0.1:8080/api/getUser   实际代理为：http://127.0.0.1:8000/user/getUser</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ^~/api</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_pass</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> http://127.0.0.1:8000/user</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Host</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $http_host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#后台可以获取到完整的ip+端口号</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> X-Real-IP</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $remote_addr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#后台可以获取到用户访问的真实ip地址</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # 请求路径为：http://127.0.0.1:8080/api/getUser   实际代理为：http://127.0.0.1:8000/usergetUser</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ^~/api/</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_pass</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> http://127.0.0.1:8000/user</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Host</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $http_host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#后台可以获取到完整的ip+端口号</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> X-Real-IP</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $remote_addr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#后台可以获取到用户访问的真实ip地址</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    #################### 第四种场景 ####################</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # 请求路径为：http://127.0.0.1:8080/api/getUser   实际代理为：http://127.0.0.1:8000/user/getUser</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ^~/api/</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_pass</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> http://127.0.0.1:8000/user/</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Host</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $http_host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#后台可以获取到完整的ip+端口号</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> X-Real-IP</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $remote_addr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#后台可以获取到用户访问的真实ip地址</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # 请求路径为：http://127.0.0.1:8080/api/getUser   实际代理为：http://127.0.0.1:8000/user//getUser</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ^~/api</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_pass</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> http://127.0.0.1:8000/user/</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Host</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $http_host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#后台可以获取到完整的ip+端口号</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> X-Real-IP</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $remote_addr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#后台可以获取到用户访问的真实ip地址</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  # 演示前端项目部署加访问前缀的nginx配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  server</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    listen</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 8090</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    server_name</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> localhost</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # 部署路径：/home/web/my_demo</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # 访问路径为：http://localhost:8090/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      try_files</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $uri</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $uri</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /index.html</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> X-Real-IP</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $remote_addr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Host</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $http_host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /home/web/my_demo/</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      index</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> index.html</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> index.htm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # 部署路径：/home/web/my_demo</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # 访问路径为：http://localhost:8090/my_demo/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # 如果location路径最后没有配置斜杠，则浏览器输入访问地址后，路径最后会自动拼一个斜杠</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    location</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ^~/my_demo/</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      try_files</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $uri</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $uri</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /my_demo/index.html</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> X-Real-IP</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $remote_addr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      proxy_set_header</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Host</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $http_host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /home/web/</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      index</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> index.html</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> index.htm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>##nginx.conf配置</p><h3 id="nginx的http配置主要包括四个区块" tabindex="-1"><a class="header-anchor" href="#nginx的http配置主要包括四个区块"><span>nginx的HTTP配置主要包括四个区块</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>http {//协议级别</span></span>
<span class="line"><span>  include mime.types;</span></span>
<span class="line"><span>  default_type application/octet-stream;</span></span>
<span class="line"><span>  keepalive_timeout 65;</span></span>
<span class="line"><span>  gzip on;</span></span>
<span class="line"><span>  upstream {//负载均衡配置</span></span>
<span class="line"><span>    …</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  server {//服务器级别，每个server类似于httpd中的一个</span></span>
<span class="line"><span>    listen 80;</span></span>
<span class="line"><span>    server_name localhost;</span></span>
<span class="line"><span>    location / {//请求级别，类似于httpd中的，用于定义URL与本地文件系统的映射关系</span></span>
<span class="line"><span>      root html;</span></span>
<span class="line"><span>      index index.html index.htm;</span></span>
<span class="line"><span>    } </span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="location配置" tabindex="-1"><a class="header-anchor" href="#location配置"><span>location配置</span></a></h3><h4 id="location-匹配优先级" tabindex="-1"><a class="header-anchor" href="#location-匹配优先级"><span>location 匹配优先级</span></a></h4><ul><li>= 精确匹配会第一个被处理。如果发现精确匹配，nginx停止搜索其他匹配。</li><li>普通字符匹配，正则表达式规则和长的块规则将被优先和查询匹配，也就是说如果该项匹配还需去看有没有正则表达式匹配和更长的匹配。</li><li>^~ 则只匹配该规则，nginx停止搜索其他匹配，否则nginx会继续处理其他location指令。</li><li>最后匹配理带有&quot;<sub>&quot;和&quot;</sub>*&quot;的指令，如果找到相应的匹配，则nginx停止搜索其他匹配；当没有正则表达式或者没有正则表达式被匹配的情况下，那么匹配程度最高的逐字匹配指令会被使用。</li></ul><h4 id="location规则" tabindex="-1"><a class="header-anchor" href="#location规则"><span>location规则</span></a></h4><h5 id="_1-location和proxy-pass都带-则真实地址不带location匹配目录" tabindex="-1"><a class="header-anchor" href="#_1-location和proxy-pass都带-则真实地址不带location匹配目录"><span>1.location和proxy_pass都带/，则真实地址不带location匹配目录</span></a></h5><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>location /api/ {</span></span>
<span class="line"><span>    proxy_pass http://127.0.0.1:8080/;</span></span>
<span class="line"><span>    #访问地址：example.taotaozn.com/api/upload--&gt;http://127.0.0.1:8080/upload</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-location不带-proxy-pass带-则真实地址会带" tabindex="-1"><a class="header-anchor" href="#_2-location不带-proxy-pass带-则真实地址会带"><span>2.location不带/，proxy_pass带/，则真实地址会带/</span></a></h5><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>location /api {</span></span>
<span class="line"><span>    proxy_pass http://127.0.0.1:8080/;</span></span>
<span class="line"><span>    #访问地址： example.taotaozn.com/api/upload--&gt;http://127.0.0.1:8080//upload</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-location带-proxy-pass不带-则真实地址会带location匹配目录-api" tabindex="-1"><a class="header-anchor" href="#_3-location带-proxy-pass不带-则真实地址会带location匹配目录-api"><span>3.location带/，proxy_pass不带/，则真实地址会带location匹配目录/api/</span></a></h5><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>location /api/ {</span></span>
<span class="line"><span>    proxy_pass http://127.0.0.1:8080;</span></span>
<span class="line"><span>    #访问地址： example.taotaozn.com/api/upload--&gt;http://127.0.0.1:8080/api/upload</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-location和proxy-pass都不带-则真实地址会带location匹配目录-api" tabindex="-1"><a class="header-anchor" href="#_4-location和proxy-pass都不带-则真实地址会带location匹配目录-api"><span>4.location和proxy_pass都不带/，则真实地址会带location匹配目录/api/</span></a></h5><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>location /api {</span></span>
<span class="line"><span>    proxy_pass http://127.0.0.1:8080;</span></span>
<span class="line"><span>    #访问地址： www.test.com/api/upload--&gt;http://127.0.0.1:8080/api/upload</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_5-同1-location和proxy-pass都带-但-proxy-pass带地址" tabindex="-1"><a class="header-anchor" href="#_5-同1-location和proxy-pass都带-但-proxy-pass带地址"><span>5.同1，location和proxy_pass都带/，但 proxy_pass带地址</span></a></h5><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>location /api/ {</span></span>
<span class="line"><span>    proxy_pass http://127.0.0.1:8080/server/;</span></span>
<span class="line"><span>    #访问地址： www.test.com/api/upload--&gt;http://127.0.0.1:8080/server/upload</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_6-同2-但-proxy-pass带地址-则真实地址会多个" tabindex="-1"><a class="header-anchor" href="#_6-同2-但-proxy-pass带地址-则真实地址会多个"><span>6.同2，但 proxy_pass带地址，则真实地址会多个/</span></a></h5><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>location /api {</span></span>
<span class="line"><span>    proxy_pass http://127.0.0.1:8080/server/;</span></span>
<span class="line"><span>    #访问地址： www.test.com/api/upload--&gt;http://127.0.0.1:8080/server//upload</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_7-同3-但-proxy-pass带地址-则真实地址会直接连起来" tabindex="-1"><a class="header-anchor" href="#_7-同3-但-proxy-pass带地址-则真实地址会直接连起来"><span>7.同3，但 proxy_pass带地址，则真实地址会直接连起来</span></a></h5><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>location /api/ {</span></span>
<span class="line"><span>    proxy_pass http://127.0.0.1:8080/server;</span></span>
<span class="line"><span>    #访问地址： www.test.com/api/upload--&gt;http://127.0.0.1:8080/serverupload</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_8-同4-但-proxy-pass带地址-则真实地址匹配地址会替换location匹配目录" tabindex="-1"><a class="header-anchor" href="#_8-同4-但-proxy-pass带地址-则真实地址匹配地址会替换location匹配目录"><span>8.同4，但 proxy_pass带地址，则真实地址匹配地址会替换location匹配目录</span></a></h5><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>location /api{</span></span>
<span class="line"><span>    proxy_pass http://127.0.0.1:8080/server;</span></span>
<span class="line"><span>    #访问地址： www.test.com/api/upload--&gt;http://127.0.0.1:8080/server/upload</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="location语法" tabindex="-1"><a class="header-anchor" href="#location语法"><span>location语法</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>location [=||*|^~] /uri/ { … }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>= 严格匹配。如果请求匹配这个location，那么将停止搜索并立即处理此请求</li><li>~ 区分大小写匹配(可用正则表达式)</li><li>~* 不区分大小写匹配(可用正则表达式)</li><li>!~ 区分大小写不匹配</li><li>!~* 不区分大小写不匹配</li><li>^~ 如果把这个前缀用于一个常规字符串,那么告诉nginx 如果路径匹配那么不测试正则表达式</li></ul><h4 id="alias与root的区别" tabindex="-1"><a class="header-anchor" href="#alias与root的区别"><span>alias与root的区别</span></a></h4><ul><li>root 实际访问文件路径会拼接URL中的路径</li><li>alias 实际访问文件路径不会拼接URL中的路径</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>location ^~ /scootor/ { </span></span>
<span class="line"><span>    alias /usr/local/nginx/html/static/; </span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>#请求：http://example.taotaozn.com/scootor/index.html</span></span>
<span class="line"><span>#实际访问：/usr/local/nginx/html/static/index.html文件</span></span>
<span class="line"><span></span></span>
<span class="line"><span>location ^~ /scootor/ { </span></span>
<span class="line"><span>    root /usr/local/nginx/html/; </span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>#请求：http://example.taotaozn.com/scootor/index.html</span></span>
<span class="line"><span>#实际访问：/usr/local/nginx/html/scootor/index.html文件</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="rewrite" tabindex="-1"><a class="header-anchor" href="#rewrite"><span>rewrite</span></a></h3><p>语法：rewrite regex replacement flag 应用于：server location location中的if</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>location  /images {</span></span>
<span class="line"><span>    rewrite ^/images/(.*\\.jpg)$ /imgs/$1 break;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="last和break关键字的区别" tabindex="-1"><a class="header-anchor" href="#last和break关键字的区别"><span>last和break关键字的区别</span></a></h5><ul><li>last 和 break 当出现在location 之外时，两者的作用是一致的没有任何差异</li><li>last 和 break 当出现在location 内部时： <ul><li>last: rewrite后会跳出location作用域，重新开始再走一次刚才的行为， 当前的匹配结束，继续下一个匹配，最多匹配10个到20个，一旦此rewrite规则重写完成后， 就不再被后面其它的rewrite规则进行处理 而是由UserAgent重新对重写后的URL再一次发起请求， 并从头开始执行类似的过程</li><li>break: rewrite后不会跳出location 作用域，它的生命也在这个location中终结 中止Rewrite，不再继续匹配，一旦此rewrite规则重写完成后，由UserAgent对新的URL重新发起请求， 且不再会被当前location内的任何rewrite规则所检查</li></ul></li></ul><h5 id="permanent和redirect关键字的区别" tabindex="-1"><a class="header-anchor" href="#permanent和redirect关键字的区别"><span>permanent和redirect关键字的区别</span></a></h5><ul><li>rewrite … permanent 永久性重定向，请求日志中的状态码为301</li><li>rewrite … redirect 临时重定向，请求日志中的状态码为302</li></ul><h4 id="try-files" tabindex="-1"><a class="header-anchor" href="#try-files"><span>try_files</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>location / {</span></span>
<span class="line"><span>    try_files $uri $uri/ /index.html?$args;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span># 语法：try_files file1 [file2 ... filen] fallback</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="if" tabindex="-1"><a class="header-anchor" href="#if"><span>if</span></a></h4><p>语法：if (condition) {…} 应用于：server和location</p><h5 id="常见condition" tabindex="-1"><a class="header-anchor" href="#常见condition"><span>常见condition</span></a></h5><ul><li>变量名（变量值为空串，或者以“0”开始，则为false，其它的均为true）</li><li>以变量为操作数构成的比较表达式（可使用=，!=类似的比较操作符进行测试）</li><li>正则表达式的模式匹配操作 <ul><li>~：区分大小写的模式匹配检查</li><li>~*：不区分大小写的模式匹配检查</li><li>!~和 !~*：对上面两种取反</li></ul></li><li>指定路径为文件的可能性（-f，!-f)</li><li>指定路径为目录的可能性（-d，!-d）</li><li>文件的存在性（-e，!-e）</li><li>文件是否有执行权限（-x，!-x）</li></ul><h6 id="浏览器实现分离案例" tabindex="-1"><a class="header-anchor" href="#浏览器实现分离案例"><span>浏览器实现分离案例</span></a></h6><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>if ($http_user_agent ~ Firefox) {</span></span>
<span class="line"><span>  rewrite ^(.*)$ /firefox/$1 break;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>if ($http_user_agent ~ MSIE) {</span></span>
<span class="line"><span>  rewrite ^(.*)$ /msie/$1 break;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>if ($http_user_agent ~ Chrome) {</span></span>
<span class="line"><span>  rewrite ^(.*)$ /chrome/$1 break;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="nginx防盗链配置" tabindex="-1"><a class="header-anchor" href="#nginx防盗链配置"><span>nginx防盗链配置</span></a></h4><p>语法：valid_referers [none|blocked|server_names] ... 默认值：none 这个指令在referer头的基础上为 $invalid_referer 变量赋值，其值为0或1。 如果valid_referers列表中没有Referer头的值， $invalid_referer将被设置为1 应用于：server和location</p><h5 id="防盗链案例" tabindex="-1"><a class="header-anchor" href="#防盗链案例"><span>防盗链案例</span></a></h5><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>location ~* \\.(jpg|gif|jpeg|png)$ {</span></span>
<span class="line"><span>  valid_referers none blocked www.test.com;</span></span>
<span class="line"><span>  if ($invalid_referer) {</span></span>
<span class="line"><span>    rewrite ^/ http://www.test.com/403.html;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="nginx的cors配置" tabindex="-1"><a class="header-anchor" href="#nginx的cors配置"><span>nginx的cors配置</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>server {</span></span>
<span class="line"><span>    listen       80;</span></span>
<span class="line"><span>    server_name  localhost;</span></span>
<span class="line"><span>    #判断请求域名是否是指定域名的子域名，如果是，则将内置域名赋值给内置变量$allow_url，便于指定Access-Control-Allow-Origin</span></span>
<span class="line"><span>    if ( $http_origin ~ http://(.*).taotaozn.com){</span></span>
<span class="line"><span>          set $allow_url $http_origin;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    #是否允许请求带有验证信息</span></span>
<span class="line"><span>    add_header Access-Control-Allow-Credentials true;</span></span>
<span class="line"><span>    #允许跨域访问的域名,可以是一个域的列表，也可以是通配符*</span></span>
<span class="line"><span>    add_header Access-Control-Allow-Origin  $allow_url;</span></span>
<span class="line"><span>    #允许脚本访问的返回头</span></span>
<span class="line"><span>    add_header Access-Control-Allow-Headers &#39;x-requested-with,content-type,Cache-Control,Pragma,Date,x-timestamp&#39;;</span></span>
<span class="line"><span>    #允许使用的请求方法，以逗号隔开</span></span>
<span class="line"><span>    add_header Access-Control-Allow-Methods &#39;POST,GET,OPTIONS,PUT,DELETE&#39;;</span></span>
<span class="line"><span>    #允许自定义的头部，以逗号隔开,大小写不敏感</span></span>
<span class="line"><span>    add_header Access-Control-Expose-Headers &#39;WWW-Authenticate,Server-Authorization&#39;;</span></span>
<span class="line"><span>    #P3P支持跨域cookie操作</span></span>
<span class="line"><span>    add_header P3P &#39;policyref=&quot;/w3c/p3p.xml&quot;, CP=&quot;NOI DSP PSAa OUR BUS IND ONL UNI COM NAV INT LOC&quot;&#39;;</span></span>
<span class="line"><span>    add_header test  1;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    if ($request_method = &#39;OPTIONS&#39;) {</span></span>
<span class="line"><span>         return 204;</span></span>
<span class="line"><span>     }</span></span>
<span class="line"><span>    location  / {</span></span>
<span class="line"><span>         root html;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    location = /demo/test1.html {</span></span>
<span class="line"><span>         proxy_pass http://www.tataozn.com/demo/test1.html;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    error_page   500 502 503 504  /50x.html;</span></span>
<span class="line"><span>    location  /50x.html {</span></span>
<span class="line"><span>        root   html;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="nginx通过expires配置缓存" tabindex="-1"><a class="header-anchor" href="#nginx通过expires配置缓存"><span>nginx通过expires配置缓存</span></a></h4><p>语法：expires [time|@time-of-day|epoch|max|off] 默认值：expires off 应用于：http、server和location</p><blockquote><p>注意：expires仅仅适用于200, 204, 301, 302,和304应答</p></blockquote><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#经常使用的配置</span></span>
<span class="line"><span>#告知浏览器缓存此文件并设置缓存时间</span></span>
<span class="line"><span>location ~ .*.(gif|jpg|jpeg|png|bmp|swf)$ {</span></span>
<span class="line"><span>    expires 10s;#缓存2秒</span></span>
<span class="line"><span>    #expires 2m;#缓存2分钟</span></span>
<span class="line"><span>    #expires 2h;#缓存2小时</span></span>
<span class="line"><span>    #expires 2d;#缓存2天</span></span>
<span class="line"><span>    root   html;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="nginx的gzip配置" tabindex="-1"><a class="header-anchor" href="#nginx的gzip配置"><span>nginx的gzip配置</span></a></h4><p>语法：gzip on|off 默认值：gzip off 应用于：http, server, location, location中的if</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># 搭配</span></span>
<span class="line"><span>gzip_types：默认值为gzip_types text/html ；为除“text/html”之外的MIME类型启用压缩，“text/html”总是会被压缩。</span></span>
<span class="line"><span>gzip_min_length：默认值为gzip_min_length 0 ；设置被压缩的最小请求，单位为bytes。少于这个值大小的请求将不会被压缩，这个值由请求头中的Content-Length字段决定。</span></span>
<span class="line"><span>gzip_buffers ：默认值为gzip_buffers 4 4k/8k ；指定缓存压缩应答的缓冲区数量和大小，如果不设置，一个缓存区的大小为分页大小，根据环境的不同可能是4k或8k。</span></span>
<span class="line"><span>gzip_comp_level ：默认值为gzip_comp_level 1 ；指定压缩等级，其值从1到9，1为最小化压缩（处理速度快），9为最大化压缩（处理速度慢）。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>location  / {</span></span>
<span class="line"><span>    # 对js、css、html格式的文件启用gzip压缩功能,图片格式由于压缩比例太小，且压缩耗费cpu不建议压缩</span></span>
<span class="line"><span>    gzip on; # 启用gzip压缩，默认是off，不启用</span></span>
<span class="line"><span>    gzip_types application/javascript text/css;#为除“text/html”之外的MIME类型启用压缩，“text/html”总是会被压缩。</span></span>
<span class="line"><span>    gzip_min_length 1024; # 所压缩文件的最小值，小于这个的不会压缩</span></span>
<span class="line"><span>    gzip_buffers 4 1k; # 设置压缩响应的缓冲块的大小和个数，默认是内存一个页的大小</span></span>
<span class="line"><span>    gzip_comp_level 1; # 压缩水平，默认1。取值范围1-9，取值越大压缩比率越大，但越耗cpu时间</span></span>
<span class="line"><span>    root  html;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,63),t=[e];function p(h,r){return a(),i("div",null,t)}const c=s(l,[["render",p],["__file","Nginx常用操作及配置.html.vue"]]),o=JSON.parse('{"path":"/zh/posts/nginx/Nginx%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E5%8F%8A%E9%85%8D%E7%BD%AE.html","title":"Nginx常用操作及配置","lang":"zh-CN","frontmatter":{"title":"Nginx常用操作及配置","date":"2022-09-30T23:24:15.000Z","updated":"2023-03-06T09:53:15.000Z","categories":"Nginx","tags":"Nginx","description":"Nginx常用操作及配置 常用操作 常见配置 ##nginx.conf配置 nginx的HTTP配置主要包括四个区块 location配置 location 匹配优先级 = 精确匹配会第一个被处理。如果发现精确匹配，nginx停止搜索其他匹配。 普通字符匹配，正则表达式规则和长的块规则将被优先和查询匹配，也就是说如果该项匹配还需去看有没有正则表达式匹配...","head":[["meta",{"property":"og:url","content":"https://mister-hope.github.io/zh/posts/nginx/Nginx%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E5%8F%8A%E9%85%8D%E7%BD%AE.html"}],["meta",{"property":"og:site_name","content":"博客"}],["meta",{"property":"og:title","content":"Nginx常用操作及配置"}],["meta",{"property":"og:description","content":"Nginx常用操作及配置 常用操作 常见配置 ##nginx.conf配置 nginx的HTTP配置主要包括四个区块 location配置 location 匹配优先级 = 精确匹配会第一个被处理。如果发现精确匹配，nginx停止搜索其他匹配。 普通字符匹配，正则表达式规则和长的块规则将被优先和查询匹配，也就是说如果该项匹配还需去看有没有正则表达式匹配..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-06-19T08:58:34.000Z"}],["meta",{"property":"article:author","content":"chriswoodcn"}],["meta",{"property":"article:published_time","content":"2022-09-30T23:24:15.000Z"}],["meta",{"property":"article:modified_time","content":"2024-06-19T08:58:34.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Nginx常用操作及配置\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2022-09-30T23:24:15.000Z\\",\\"dateModified\\":\\"2024-06-19T08:58:34.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"chriswoodcn\\"}]}"]]},"headers":[{"level":3,"title":"常用操作","slug":"常用操作","link":"#常用操作","children":[]},{"level":3,"title":"常见配置","slug":"常见配置","link":"#常见配置","children":[]},{"level":3,"title":"nginx的HTTP配置主要包括四个区块","slug":"nginx的http配置主要包括四个区块","link":"#nginx的http配置主要包括四个区块","children":[]},{"level":3,"title":"location配置","slug":"location配置","link":"#location配置","children":[]},{"level":3,"title":"rewrite","slug":"rewrite","link":"#rewrite","children":[]}],"git":{"createdTime":1718787514000,"updatedTime":1718787514000,"contributors":[{"name":"chriswoodcn","email":"chriswoodcn@aliyun.com","commits":1}]},"readingTime":{"minutes":10.96,"words":3288},"filePathRelative":"zh/posts/nginx/Nginx常用操作及配置.md","localizedDate":"2022年9月30日","excerpt":"\\n<h3>常用操作</h3>\\n<div class=\\"language-shell line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"shell\\" data-title=\\"shell\\" style=\\"--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes github-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic\\">#强制停止Nginx</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#005CC5;--shiki-dark:#56B6C2\\">kill</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#D19A66\\"> -9</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\"> nginx</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\"> </span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#61AFEF\\">start</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\"> nginx</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#61AFEF\\">nginx</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#D19A66\\"> -s</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\"> quit</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#61AFEF\\">nginx</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#D19A66\\"> -s</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\"> reload</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}');export{c as comp,o as data};
