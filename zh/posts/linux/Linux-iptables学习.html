<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.13" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.49" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://mister-hope.github.io/zh/posts/linux/Linux-iptables%E5%AD%A6%E4%B9%A0.html"><meta property="og:site_name" content="博客"><meta property="og:title" content="Linux-iptables学习"><meta property="og:description" content="iptables介绍 iptables组成Linux平台下的包过滤防火墙，与大多数的Linux软件一样，这个包过滤防火墙是免费的，在安装系统的时候就已经自带 基础概念 1.规则（rules） 规则（rules）其实就是网络管理员预定义的条件，规则一般的定义为“如果数据包头符合这样的条件，就这样处理这个数据包”。规则存 储在内核空间的信息 包过滤表中，这..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-06-19T08:58:34.000Z"><meta property="article:author" content="chriswoodcn"><meta property="article:tag" content="Linux"><meta property="article:tag" content="iptables"><meta property="article:published_time" content="2023-06-15T13:43:19.000Z"><meta property="article:modified_time" content="2024-06-19T08:58:34.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Linux-iptables学习","image":[""],"datePublished":"2023-06-15T13:43:19.000Z","dateModified":"2024-06-19T08:58:34.000Z","author":[{"@type":"Person","name":"chriswoodcn"}]}</script><title>Linux-iptables学习 | 博客</title><meta name="description" content="iptables介绍 iptables组成Linux平台下的包过滤防火墙，与大多数的Linux软件一样，这个包过滤防火墙是免费的，在安装系统的时候就已经自带 基础概念 1.规则（rules） 规则（rules）其实就是网络管理员预定义的条件，规则一般的定义为“如果数据包头符合这样的条件，就这样处理这个数据包”。规则存 储在内核空间的信息 包过滤表中，这...">
    <link rel="preload" href="/assets/style-sqluUE2b.css" as="style"><link rel="stylesheet" href="/assets/style-sqluUE2b.css">
    <link rel="modulepreload" href="/assets/app-BzNy2ypN.js"><link rel="modulepreload" href="/assets/Linux-iptables学习.html-qnnkHyt6.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-24QydFnM.js" as="script"><link rel="prefetch" href="/assets/intro.html-DwAtv-7S.js" as="script"><link rel="prefetch" href="/assets/index.html-Uafj3dHA.js" as="script"><link rel="prefetch" href="/assets/intro.html-CWrflOyH.js" as="script"><link rel="prefetch" href="/assets/docker-compose.html-CuGH2OUe.js" as="script"><link rel="prefetch" href="/assets/docker-entrypoint.sh脚本.html-DFkQkvHY.js" as="script"><link rel="prefetch" href="/assets/docker-repository.html-CRIRYBBn.js" as="script"><link rel="prefetch" href="/assets/docker安装及CA证书制作.html-YrIlf4ol.js" as="script"><link rel="prefetch" href="/assets/docker环境部署集群前后端分离项目.html-yArr4iGp.js" as="script"><link rel="prefetch" href="/assets/docker镜像构建方式.html-DkzOObY6.js" as="script"><link rel="prefetch" href="/assets/机电实务.html-BwBhih2v.js" as="script"><link rel="prefetch" href="/assets/开发环境配置.html-DCJAsNGe.js" as="script"><link rel="prefetch" href="/assets/gradle环境配置.html-DejH2S67.js" as="script"><link rel="prefetch" href="/assets/docker部署hbase.html-CSG-Vp7x.js" as="script"><link rel="prefetch" href="/assets/EditorConfig配置.html-CR-cl7YV.js" as="script"><link rel="prefetch" href="/assets/docker部署kafka集群.html-C52JizNr.js" as="script"><link rel="prefetch" href="/assets/kafka学习.html-hClD-d-L.js" as="script"><link rel="prefetch" href="/assets/Grammer.html--UPb8nUs.js" as="script"><link rel="prefetch" href="/assets/docker、crictl、ctr命令集合.html-C5WS-9jI.js" as="script"><link rel="prefetch" href="/assets/helm部署应用合集.html-B234EBlL.js" as="script"><link rel="prefetch" href="/assets/istio入门.html-CLOsYGQ7.js" as="script"><link rel="prefetch" href="/assets/istio配置.html-L5R1Cotl.js" as="script"><link rel="prefetch" href="/assets/k3s部署rancher.html-Dc43vqpp.js" as="script"><link rel="prefetch" href="/assets/kubeadmin搭建k8s.html-Cd7m_Rhg.js" as="script"><link rel="prefetch" href="/assets/kubectl多集群环境切换.html-B7HY42Le.js" as="script"><link rel="prefetch" href="/assets/kubernetes安装dashboard.html-B2hOvpqo.js" as="script"><link rel="prefetch" href="/assets/kubernetes常用模板.html-CU7NKSCv.js" as="script"><link rel="prefetch" href="/assets/kubernetes阿里云应用方式.html-ihAL2GBw.js" as="script"><link rel="prefetch" href="/assets/Linux上ssh证书登录配置.html-50KVyfqo.js" as="script"><link rel="prefetch" href="/assets/centos7.html-DU3SvGzV.js" as="script"><link rel="prefetch" href="/assets/crontab命令.html-6uW8e5Ys.js" as="script"><link rel="prefetch" href="/assets/shell脚本编辑.html-4N6jKAcP.js" as="script"><link rel="prefetch" href="/assets/Nginx常用操作及配置.html-C_xtp8TX.js" as="script"><link rel="prefetch" href="/assets/Nginx日志按天切割.html--X0tMgOi.js" as="script"><link rel="prefetch" href="/assets/springboot日志配置.html-ByjXXG1n.js" as="script"><link rel="prefetch" href="/assets/springboot配置文件.html-Buoto5rp.js" as="script"><link rel="prefetch" href="/assets/md数学公式编辑.html-BWHjWojd.js" as="script"><link rel="prefetch" href="/assets/batch命令.html-BNC842E9.js" as="script"><link rel="prefetch" href="/assets/SuppressWarnings注解.html-s3GB7Trn.js" as="script"><link rel="prefetch" href="/assets/Java高并发专题-JUC线程池.html-D3DDXTQ1.js" as="script"><link rel="prefetch" href="/assets/maven项目pom-xml配置说明.html-DpvXjFl1.js" as="script"><link rel="prefetch" href="/assets/RedisTemplate的opsFor操作.html-uL5Z89lp.js" as="script"><link rel="prefetch" href="/assets/Mysql基础.html-D_yzVNnQ.js" as="script"><link rel="prefetch" href="/assets/Node基础一.html-BrZw5nE5.js" as="script"><link rel="prefetch" href="/assets/Node基础七.html-C-a0x_dR.js" as="script"><link rel="prefetch" href="/assets/Node基础三.html-DqmqrVqs.js" as="script"><link rel="prefetch" href="/assets/Node基础九.html-CwJ1tF6o.js" as="script"><link rel="prefetch" href="/assets/Node基础二.html-B7FTEf63.js" as="script"><link rel="prefetch" href="/assets/Node基础五.html-Dm9j_vXl.js" as="script"><link rel="prefetch" href="/assets/Node基础八.html-BIV-glE9.js" as="script"><link rel="prefetch" href="/assets/Node基础六.html-CP3xL6T4.js" as="script"><link rel="prefetch" href="/assets/Node基础十.html-Dwh5YVB5.js" as="script"><link rel="prefetch" href="/assets/Node基础十一.html-DsACIMRG.js" as="script"><link rel="prefetch" href="/assets/Node基础十二.html-vczTukoc.js" as="script"><link rel="prefetch" href="/assets/Node基础四.html-BqxMTZyt.js" as="script"><link rel="prefetch" href="/assets/404.html-DYLmxTWQ.js" as="script"><link rel="prefetch" href="/assets/index.html-D7Zzn-LR.js" as="script"><link rel="prefetch" href="/assets/index.html-CtoXuIzp.js" as="script"><link rel="prefetch" href="/assets/index.html-CPMuuQNq.js" as="script"><link rel="prefetch" href="/assets/index.html-By2ZKKaj.js" as="script"><link rel="prefetch" href="/assets/index.html-WQaAnb5p.js" as="script"><link rel="prefetch" href="/assets/index.html-DriGi-c8.js" as="script"><link rel="prefetch" href="/assets/index.html-DU-2xeN-.js" as="script"><link rel="prefetch" href="/assets/index.html-CvXt4ERq.js" as="script"><link rel="prefetch" href="/assets/index.html-BffOz5ey.js" as="script"><link rel="prefetch" href="/assets/index.html-DaE8xN6e.js" as="script"><link rel="prefetch" href="/assets/index.html-pE5SFf7j.js" as="script"><link rel="prefetch" href="/assets/index.html-CoIV4LpY.js" as="script"><link rel="prefetch" href="/assets/index.html-DEl5z6ep.js" as="script"><link rel="prefetch" href="/assets/index.html-rciPl_Qj.js" as="script"><link rel="prefetch" href="/assets/index.html-CZJV8S9B.js" as="script"><link rel="prefetch" href="/assets/index.html-_AXZonzz.js" as="script"><link rel="prefetch" href="/assets/index.html-Mv7eVdCC.js" as="script"><link rel="prefetch" href="/assets/index.html-CsrHwhB-.js" as="script"><link rel="prefetch" href="/assets/index.html-CpfS5xge.js" as="script"><link rel="prefetch" href="/assets/index.html-CILoBdYk.js" as="script"><link rel="prefetch" href="/assets/index.html-B1QHPFbx.js" as="script"><link rel="prefetch" href="/assets/index.html-DKWJ2npR.js" as="script"><link rel="prefetch" href="/assets/index.html-DEQEjF_o.js" as="script"><link rel="prefetch" href="/assets/index.html-udSlRvlm.js" as="script"><link rel="prefetch" href="/assets/index.html-1NL2cvSS.js" as="script"><link rel="prefetch" href="/assets/index.html-B1R13J_A.js" as="script"><link rel="prefetch" href="/assets/index.html-DgjWz3JA.js" as="script"><link rel="prefetch" href="/assets/index.html-BdLVJWMK.js" as="script"><link rel="prefetch" href="/assets/index.html-DOO1PRhI.js" as="script"><link rel="prefetch" href="/assets/index.html-BXBtSFq-.js" as="script"><link rel="prefetch" href="/assets/index.html-CWWV8AtF.js" as="script"><link rel="prefetch" href="/assets/index.html-CxUvLQwC.js" as="script"><link rel="prefetch" href="/assets/index.html-Bp0CZ2yG.js" as="script"><link rel="prefetch" href="/assets/index.html-BTbNKndA.js" as="script"><link rel="prefetch" href="/assets/index.html-CX77jy6a.js" as="script"><link rel="prefetch" href="/assets/index.html-DBsr1t3f.js" as="script"><link rel="prefetch" href="/assets/index.html-CPeqUHj-.js" as="script"><link rel="prefetch" href="/assets/index.html-CjpZHOfJ.js" as="script"><link rel="prefetch" href="/assets/index.html-C1KcYbZZ.js" as="script"><link rel="prefetch" href="/assets/index.html-BWMq9pGP.js" as="script"><link rel="prefetch" href="/assets/index.html-BXQhNFba.js" as="script"><link rel="prefetch" href="/assets/index.html-D2E1iSPq.js" as="script"><link rel="prefetch" href="/assets/index.html-BaZamSMQ.js" as="script"><link rel="prefetch" href="/assets/index.html-BHWr-76u.js" as="script"><link rel="prefetch" href="/assets/index.html-0S9HijXL.js" as="script"><link rel="prefetch" href="/assets/index.html-BVs9rDQu.js" as="script"><link rel="prefetch" href="/assets/index.html-Bk2VkTB4.js" as="script"><link rel="prefetch" href="/assets/index.html-DyArZ67N.js" as="script"><link rel="prefetch" href="/assets/index.html-Br-vgMge.js" as="script"><link rel="prefetch" href="/assets/index.html-DcVdxYNL.js" as="script"><link rel="prefetch" href="/assets/index.html-DI6Lmj8u.js" as="script"><link rel="prefetch" href="/assets/index.html-Cg_DX7MX.js" as="script"><link rel="prefetch" href="/assets/index.html-Cves3iKy.js" as="script"><link rel="prefetch" href="/assets/index.html-BijPkuQJ.js" as="script"><link rel="prefetch" href="/assets/index.html-CZXnHh2x.js" as="script"><link rel="prefetch" href="/assets/index.html-DsjO8q72.js" as="script"><link rel="prefetch" href="/assets/index.html-CQoDD8sO.js" as="script"><link rel="prefetch" href="/assets/index.html-6bl6e7r8.js" as="script"><link rel="prefetch" href="/assets/index.html-Cto6Z4CL.js" as="script"><link rel="prefetch" href="/assets/index.html-KSo7E-lK.js" as="script"><link rel="prefetch" href="/assets/index.html-BCDImrJr.js" as="script"><link rel="prefetch" href="/assets/index.html-C_YIZbyj.js" as="script"><link rel="prefetch" href="/assets/index.html-BhVapwYj.js" as="script"><link rel="prefetch" href="/assets/index.html-CIZtTKcO.js" as="script"><link rel="prefetch" href="/assets/index.html-CEFcAU07.js" as="script"><link rel="prefetch" href="/assets/index.html-bZWQGeC3.js" as="script"><link rel="prefetch" href="/assets/index.html-C8yA_JC3.js" as="script"><link rel="prefetch" href="/assets/index.html-CTrHt1QP.js" as="script"><link rel="prefetch" href="/assets/index.html-BLzcK4YS.js" as="script"><link rel="prefetch" href="/assets/index.html-CwQScyxk.js" as="script"><link rel="prefetch" href="/assets/index.html-D0Rfyjv4.js" as="script"><link rel="prefetch" href="/assets/index.html-KbJiu6_g.js" as="script"><link rel="prefetch" href="/assets/index.html-B8U41587.js" as="script"><link rel="prefetch" href="/assets/index.html-C0nBEwLZ.js" as="script"><link rel="prefetch" href="/assets/index.html-E51WOpPq.js" as="script"><link rel="prefetch" href="/assets/index.html-C0ojA3gY.js" as="script"><link rel="prefetch" href="/assets/index.html-DJquWm1o.js" as="script"><link rel="prefetch" href="/assets/index.html-C1OuL6bZ.js" as="script"><link rel="prefetch" href="/assets/index.html-Bl8sKUeO.js" as="script"><link rel="prefetch" href="/assets/index.html-uyW0WkTn.js" as="script"><link rel="prefetch" href="/assets/index.html-MqMdXg6C.js" as="script"><link rel="prefetch" href="/assets/index.html-CGFwocb7.js" as="script"><link rel="prefetch" href="/assets/index.html-P7daMAqo.js" as="script"><link rel="prefetch" href="/assets/index.html-DWE5kRtg.js" as="script"><link rel="prefetch" href="/assets/index.html-CiWrTkPO.js" as="script"><link rel="prefetch" href="/assets/index.html-DR4XDPUD.js" as="script"><link rel="prefetch" href="/assets/index.html-BmCtUuNJ.js" as="script"><link rel="prefetch" href="/assets/index.html-o3-r4UQ9.js" as="script"><link rel="prefetch" href="/assets/index.html-CQoDD8sO.js" as="script"><link rel="prefetch" href="/assets/index.html-cAl7YsE9.js" as="script"><link rel="prefetch" href="/assets/index.html-CQP5E-2_.js" as="script"><link rel="prefetch" href="/assets/index.html-CZEqFZN5.js" as="script"><link rel="prefetch" href="/assets/index.html-8N9Cft4T.js" as="script"><link rel="prefetch" href="/assets/index.html-DDDkW2ZV.js" as="script"><link rel="prefetch" href="/assets/index.html-C5pu4YBo.js" as="script"><link rel="prefetch" href="/assets/index.html-BztY4eE4.js" as="script"><link rel="prefetch" href="/assets/index.html-Cy4deM0U.js" as="script"><link rel="prefetch" href="/assets/index.html-BBNHy1WT.js" as="script"><link rel="prefetch" href="/assets/index.html-BPRuvjkR.js" as="script"><link rel="prefetch" href="/assets/index.html-BdXBc3J4.js" as="script"><link rel="prefetch" href="/assets/index.html-jXziTrXD.js" as="script"><link rel="prefetch" href="/assets/index.html-ITG7aBXR.js" as="script"><link rel="prefetch" href="/assets/index.html-B6ouWKp-.js" as="script"><link rel="prefetch" href="/assets/index.html-Bg55ZfA5.js" as="script"><link rel="prefetch" href="/assets/playground.min-3ib3D5pN.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-GXRgw7eJ.js" as="script"><link rel="prefetch" href="/assets/SearchResult-Dpt5_qOc.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/zh/"><img class="vp-nav-logo" src="/logo.png" alt><!----><span class="vp-site-name hide-in-pad">博客</span></a><!--[--><button type="button" class="search-pro-button" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----></div><div class="vp-navbar-center"><!----><!----><!----></div><div class="vp-navbar-end"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/zh/" aria-label="主页"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="home" width="1em" height="1em"></iconify-icon><!--]-->主页<!----></a></div></nav><div class="vp-nav-item"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="选择语言"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon i18n-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="i18n icon" name="i18n" style="width:1rem;height:1rem;vertical-align:middle;"><path d="M379.392 460.8 494.08 575.488l-42.496 102.4L307.2 532.48 138.24 701.44l-71.68-72.704L234.496 460.8l-45.056-45.056c-27.136-27.136-51.2-66.56-66.56-108.544h112.64c7.68 14.336 16.896 27.136 26.112 35.84l45.568 46.08 45.056-45.056C382.976 312.32 409.6 247.808 409.6 204.8H0V102.4h256V0h102.4v102.4h256v102.4H512c0 70.144-37.888 161.28-87.04 210.944L378.88 460.8zM576 870.4 512 1024H409.6l256-614.4H768l256 614.4H921.6l-64-153.6H576zM618.496 768h196.608L716.8 532.48 618.496 768z"></path></svg><!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/" aria-label="English"><!---->English<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/zh/posts/linux/Linux-iptables%E5%AD%A6%E4%B9%A0.html" aria-label="简体中文"><!---->简体中文<!----></a></li></ul></button></div></div><!----><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/zh/" aria-label="主页"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="home" width="1em" height="1em"></iconify-icon><!--]-->主页<!----></a></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header clickable"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="laptop-code" width="1em" height="1em"></iconify-icon><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/zh/demo/" aria-label="如何使用"><!---->如何使用<!----></a><!----></p><ul class="vp-sidebar-links"></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header active"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="book" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">文章</span><!----></p><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Constructor</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Docker</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Env</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Gradle</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Hbase</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Ide</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Java</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Kafka</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Kotlin</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Kubernetes</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Linux</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/zh/posts/linux/centos7.html" aria-label="CentOS"><!---->CentOS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/zh/posts/linux/crontab%E5%91%BD%E4%BB%A4.html" aria-label="crontab命令"><!---->crontab命令<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/zh/posts/linux/Linux-iptables%E5%AD%A6%E4%B9%A0.html" aria-label="Linux-iptables学习"><!---->Linux-iptables学习<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/zh/posts/linux/Linux%E4%B8%8Assh%E8%AF%81%E4%B9%A6%E7%99%BB%E5%BD%95%E9%85%8D%E7%BD%AE.html" aria-label="Linux上ssh证书登录配置"><!---->Linux上ssh证书登录配置<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/zh/posts/linux/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E8%BE%91.html" aria-label="shell脚本编辑"><!---->shell脚本编辑<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Mysql</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Nginx</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Node</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Springboot</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Tools</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Windows</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><a class="route-link auto-link vp-sidebar-link" href="/zh/intro.html" aria-label="介绍页"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="circle-info" width="1em" height="1em"></iconify-icon><!--]-->介绍页<!----></a></li><li><a class="auto-link external-link vp-sidebar-link" href="https://plugin-md-enhance.vuejs.press/zh/guide/content/revealjs/demo.html" aria-label="幻灯片" rel="noopener noreferrer" target="_blank"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="person-chalkboard" width="1em" height="1em"></iconify-icon><!--]-->幻灯片<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Linux-iptables学习</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">chriswoodcn</span></span><span property="author" content="chriswoodcn"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-06-15T13:43:19.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 24 分钟</span><meta property="timeRequired" content="PT24M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color2 clickable" role="navigation">Linux</span><!--]--><meta property="articleSection" content="Linux"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color2 clickable" role="navigation">Linux</span><span class="page-tag-item color3 clickable" role="navigation">iptables</span><!--]--><meta property="keywords" content="Linux,iptables"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#iptables介绍">iptables介绍</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#基础概念">基础概念</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-规则-rules">1.规则（rules）</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-规则表和链">2.规则表和链</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#命令行">命令行</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#规则设置">规则设置</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#添加常用策略">添加常用策略</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#删除iptables规则">删除iptables规则</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#修改iptables规则">修改iptables规则</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#防火墙规则的保存与恢复">防火墙规则的保存与恢复</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h2 id="iptables介绍" tabindex="-1"><a class="header-anchor" href="#iptables介绍"><span>iptables介绍</span></a></h2><p>iptables组成Linux平台下的包过滤防火墙，与大多数的Linux软件一样，这个包过滤防火墙是免费的，在安装系统的时候就已经自带</p><h2 id="基础概念" tabindex="-1"><a class="header-anchor" href="#基础概念"><span>基础概念</span></a></h2><h3 id="_1-规则-rules" tabindex="-1"><a class="header-anchor" href="#_1-规则-rules"><span>1.规则（rules）</span></a></h3><p>规则（rules）其实就是网络管理员预定义的条件，规则一般的定义为“如果数据包头符合这样的条件，就这样处理这个数据包”。规则存 储在内核空间的信息 包过滤表中，这些规则分别指定了源地址、目的地址、传输协议（如TCP、UDP、ICMP）和服务类型（如HTTP、FTP 和SMTP）等。当数据包与规 则匹配时，iptables就根据规则所定义的方法来处理这些数据包，如放行（accept）、拒绝（reject）和 丢弃（drop）等。配置防火墙的 主要工作就是添加、修改和删除这些规则</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -L</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#Chain INPUT (policy ACCEPT)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#target     prot opt source               destination    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#ACCEPT     all  --  anywhere             VM-4-11-centos/16     </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#Chain FORWARD (policy ACCEPT)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#target     prot opt source               destination   </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#ACCEPT     all  --  anywhere             VM-4-11-centos/16       </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#Chain OUTPUT (policy ACCEPT)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#target     prot opt source               destination  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#ACCEPT     all  --  anywhere             anywhere</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 可以看出在 INPUT、FORWARD、OUTPUT着三条默认规则中都是accept，所有此时iptables没有对数据进行任何控制。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 设置默认规则</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#命令格式：iptables -P INPUT/FORWARD/OUTPUT 行为</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -P</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> OUTPUT</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DROP</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 现在在output链上设置了默认规则，即所有从本机发出的数据包都会被丢掉</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-规则表和链" tabindex="-1"><a class="header-anchor" href="#_2-规则表和链"><span>2.规则表和链</span></a></h3><p>表（tables）提供特定的功能，iptables内置了4个表，即filter表、nat表、mangle表和raw表，分别用于实现包过滤，网络地址 转换、包重构(修改)和数据跟踪处理</p><p>链（chains）是数据包传播的路径，每一条链其实就是众多规则中的一个检查清单，每一条链中可以有一条或数条规则。当一个数据包 到达一个链时，iptables就会从链中第一条规则开始检查，看该数据包是否满足规则所定义的条件。如果满足，系统就会根据该条规则 所定义的方法处理该数据包；否则iptables将继续检查下一条规则，如果该数据包不符合链中任一条规则，iptables就会根据该链预 先定义的默认策略来处理数据包</p><p>Iptables采用“表”和“链”的分层结构。在RHEL5中是四张表五个链。下面罗列一下这四张表和五个链。注意一定要明白这些表和链的关 系及作用。</p><h4 id="_1-规则表" tabindex="-1"><a class="header-anchor" href="#_1-规则表"><span>1）规则表</span></a></h4><h5 id="filter表-默认-——三个链-input、forward、output" tabindex="-1"><a class="header-anchor" href="#filter表-默认-——三个链-input、forward、output"><span>filter表（默认）——三个链：INPUT、FORWARD、OUTPUT</span></a></h5><p>作用：过滤数据包 内核模块：iptables_filter.</p><h5 id="nat表——三个链-prerouting、postrouting、output" tabindex="-1"><a class="header-anchor" href="#nat表——三个链-prerouting、postrouting、output"><span>Nat表——三个链：PREROUTING、POSTROUTING、OUTPUT</span></a></h5><p>作用：用于网络地址转换（IP、端口） 内核模块：iptable_nat</p><h5 id="mangle表——五个链-prerouting、postrouting、input、output、forward" tabindex="-1"><a class="header-anchor" href="#mangle表——五个链-prerouting、postrouting、input、output、forward"><span>Mangle表——五个链：PREROUTING、POSTROUTING、INPUT、OUTPUT、FORWARD</span></a></h5><p>作用：修改数据包的服务类型、TTL、并且可以配置路由实现QOS内核模块：iptable_mangle(设置策略时几乎不会用到它)</p><h5 id="raw表——两个链-output、prerouting" tabindex="-1"><a class="header-anchor" href="#raw表——两个链-output、prerouting"><span>Raw表——两个链：OUTPUT、PREROUTING</span></a></h5><p>作用：决定数据包是否被状态跟踪机制处理 内核模块：iptable_raw</p><h4 id="_2-规则链" tabindex="-1"><a class="header-anchor" href="#_2-规则链"><span>（2）规则链</span></a></h4><h5 id="input——进来的数据包应用此规则链中的策略" tabindex="-1"><a class="header-anchor" href="#input——进来的数据包应用此规则链中的策略"><span>INPUT——进来的数据包应用此规则链中的策略</span></a></h5><h5 id="output——外出的数据包应用此规则链中的策略" tabindex="-1"><a class="header-anchor" href="#output——外出的数据包应用此规则链中的策略"><span>OUTPUT——外出的数据包应用此规则链中的策略</span></a></h5><h5 id="forward——转发数据包时应用此规则链中的策略" tabindex="-1"><a class="header-anchor" href="#forward——转发数据包时应用此规则链中的策略"><span>FORWARD——转发数据包时应用此规则链中的策略</span></a></h5><h5 id="prerouting——对数据包作路由选择前应用此链中的规则-记住-所有的数据包进来的时侯都先由这个链处理" tabindex="-1"><a class="header-anchor" href="#prerouting——对数据包作路由选择前应用此链中的规则-记住-所有的数据包进来的时侯都先由这个链处理"><span>PREROUTING——对数据包作路由选择前应用此链中的规则（记住！所有的数据包进来的时侯都先由这个链处理）</span></a></h5><h5 id="postrouting——对数据包作路由选择后应用此链中的规则-所有的数据包出来的时侯都先由这个链处理" tabindex="-1"><a class="header-anchor" href="#postrouting——对数据包作路由选择后应用此链中的规则-所有的数据包出来的时侯都先由这个链处理"><span>POSTROUTING——对数据包作路由选择后应用此链中的规则（所有的数据包出来的时侯都先由这个链处理）</span></a></h5><h4 id="_3-规则表之间的优先顺序" tabindex="-1"><a class="header-anchor" href="#_3-规则表之间的优先顺序"><span>（3）规则表之间的优先顺序</span></a></h4><p>Raw——Mangle——Nat——filter</p><h4 id="_4-规则链之间的优先顺序-分三种情况" tabindex="-1"><a class="header-anchor" href="#_4-规则链之间的优先顺序-分三种情况"><span>（4）规则链之间的优先顺序（分三种情况）</span></a></h4><h5 id="第一种情况-入站数据流向" tabindex="-1"><a class="header-anchor" href="#第一种情况-入站数据流向"><span>第一种情况：入站数据流向</span></a></h5><p>从外界到达防火墙的数据包，先被PREROUTING规则链处理（是否修改数据包地址等），之后会进行路由选择（判断该数据包应该发往何处） ，如果数据包的目标主机是防火墙本机（比如说Internet用户访问防火墙主机中的web服务器的数据包），那么内核将其传给INPUT链进 行处理（决定是否允许通过等），通过以后再交给系统上层的应用程序（比如Apache服务器）进行响应</p><h5 id="第二冲情况-转发数据流向" tabindex="-1"><a class="header-anchor" href="#第二冲情况-转发数据流向"><span>第二冲情况：转发数据流向</span></a></h5><p>来自外界的数据包到达防火墙后，首先被PREROUTING规则链处理，之后会进行路由选择，如果数据包的目标地址是其它外部地址（比如局域 网用户通过网关访问QQ站点的数据包），则内核将其传递给FORWARD链进行处理（是否转发或拦截），然后再交给POSTROUTING规则链（ 是否修改数据包的地址等）进行处理</p><h5 id="第三种情况-出站数据流向" tabindex="-1"><a class="header-anchor" href="#第三种情况-出站数据流向"><span>第三种情况：出站数据流向</span></a></h5><p>防火墙本机向外部地址发送的数据包（比如在防火墙主机中测试公网DNS服务器时），首先被OUTPUT规则链处理，之后进行路由选择，然 后传递给POSTROUTING规则链（是否修改数据包的地址等）进行处理</p><h2 id="命令行" tabindex="-1"><a class="header-anchor" href="#命令行"><span>命令行</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># 格式</span></span>
<span class="line"><span>iptables [-t 表名] 命令选项 ［链名］ ［条件匹配］ ［-j 目标动作或跳转］</span></span>
<span class="line"><span># 说明：</span></span>
<span class="line"><span>表名、链名：    用于指定 iptables命令所操作的表和链；</span></span>
<span class="line"><span>命令选项：      用于指定管理iptables规则的方式（比如：插入、增加、删除、查看等）；</span></span>
<span class="line"><span>条件匹配：      用于指定对符合什么样条件的数据包进行处理；</span></span>
<span class="line"><span>目标动作或跳转：用于指定数据包的处理方式（比如允许通过、拒绝、丢弃、跳转（Jump）给其它链处理。</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Commands:</span></span>
<span class="line"><span>Either long or short options are allowed.</span></span>
<span class="line"><span>  --append  -A chain            Append to chain</span></span>
<span class="line"><span>  --check   -C chain            Check for the existence of a rule</span></span>
<span class="line"><span>  --delete  -D chain            Delete matching rule from chain</span></span>
<span class="line"><span>  --delete  -D chain rulenum</span></span>
<span class="line"><span>                                Delete rule rulenum (1 = first) from chain</span></span>
<span class="line"><span>  --insert  -I chain [rulenum]</span></span>
<span class="line"><span>                                Insert in chain as rulenum (default 1=first)</span></span>
<span class="line"><span>  --replace -R chain rulenum</span></span>
<span class="line"><span>                                Replace rule rulenum (1 = first) in chain</span></span>
<span class="line"><span>  --list    -L [chain [rulenum]]</span></span>
<span class="line"><span>                                List the rules in a chain or all chains</span></span>
<span class="line"><span>  --list-rules -S [chain [rulenum]]</span></span>
<span class="line"><span>                                Print the rules in a chain or all chains</span></span>
<span class="line"><span>  --flush   -F [chain]          Delete all rules in  chain or all chains</span></span>
<span class="line"><span>  --zero    -Z [chain [rulenum]]</span></span>
<span class="line"><span>                                Zero counters in chain or all chains</span></span>
<span class="line"><span>  --new     -N chain            Create a new user-defined chain</span></span>
<span class="line"><span>  --delete-chain</span></span>
<span class="line"><span>            -X [chain]          Delete a user-defined chain</span></span>
<span class="line"><span>  --policy  -P chain target</span></span>
<span class="line"><span>                                Change policy on chain to target</span></span>
<span class="line"><span>  --rename-chain</span></span>
<span class="line"><span>            -E old-chain new-chain</span></span>
<span class="line"><span>                                Change chain name, (moving any references)   </span></span>
<span class="line"><span>Options:</span></span>
<span class="line"><span>    --ipv4      -4              Nothing (line is ignored by ip6tables-restore)</span></span>
<span class="line"><span>    --ipv6      -6              Error (line is ignored by iptables-restore)</span></span>
<span class="line"><span>[!] --protocol  -p proto        protocol: by number or name, eg. `tcp&#39;</span></span>
<span class="line"><span>[!] --source    -s address[/mask][...]</span></span>
<span class="line"><span>                                source specification</span></span>
<span class="line"><span>[!] --destination -d address[/mask][...]</span></span>
<span class="line"><span>                                destination specification</span></span>
<span class="line"><span>[!] --in-interface -i input name[+]</span></span>
<span class="line"><span>                                network interface name ([+] for wildcard)</span></span>
<span class="line"><span> --jump -j target</span></span>
<span class="line"><span>                                target for rule (may load target extension)</span></span>
<span class="line"><span>  --goto      -g chain</span></span>
<span class="line"><span>                              jump to chain with no return</span></span>
<span class="line"><span>  --match       -m match</span></span>
<span class="line"><span>                                extended match (may load extension)</span></span>
<span class="line"><span>  --numeric     -n              numeric output of addresses and ports</span></span>
<span class="line"><span>[!] --out-interface -o output name[+]</span></span>
<span class="line"><span>                                network interface name ([+] for wildcard)</span></span>
<span class="line"><span>  --table       -t table        table to manipulate (default: `filter&#39;)</span></span>
<span class="line"><span>  --verbose     -v              verbose mode</span></span>
<span class="line"><span>  --wait        -w [seconds]    maximum wait to acquire xtables lock before give up</span></span>
<span class="line"><span>  --wait-interval -W [usecs]    wait time to try to acquire xtables lock</span></span>
<span class="line"><span>                                default is 1 second</span></span>
<span class="line"><span>  --line-numbers                print line numbers when listing</span></span>
<span class="line"><span>  --exact       -x              expand numbers (display exact values)</span></span>
<span class="line"><span>[!] --fragment  -f              match second or further fragments only</span></span>
<span class="line"><span>  --modprobe=&lt;command&gt;          try to insert modules using this command</span></span>
<span class="line"><span>  --set-counters PKTS BYTES     set the counter during insert/append</span></span>
<span class="line"><span>[!] --version   -V              print package version.</span></span>
<span class="line"><span>                       </span></span>
<span class="line"><span># 命令的管理控制选项</span></span>
<span class="line"><span>-A 在指定链的末尾添加（append）一条新的规则，当源（地址）或者/与 目的（地址）转换为多个地址时，这条</span></span>
<span class="line"><span>规则会加到所有可能的地址(组合)后面。</span></span>
<span class="line"><span>-D 删除（delete）指定链中的某一条规则，可以按规则序号和内容删除</span></span>
<span class="line"><span>-I 在指定链中插入（insert）一条新的规则，默认在第一行添加</span></span>
<span class="line"><span>-R 修改、替换（replace）指定链中的某一条规则，可以按规则序号和内容替换。规则序号从1开始，第一条就是序号1</span></span>
<span class="line"><span>-L 列出（list）指定链中所有的规则进行查看，如果没有选择链，所有链将被显示。也可以和z选项一起使用，这时链</span></span>
<span class="line"><span>会被自动列出和归零。精确输出受其它所给参数影响。</span></span>
<span class="line"><span>-E 重命名用户定义的链，不改变链本身</span></span>
<span class="line"><span>-F 清空（flush）</span></span>
<span class="line"><span>-N 新建（new-chain）一条用户自己定义的规则链。这个链必须没有被引用，如果被引用，在删除之前你必须删除或者</span></span>
<span class="line"><span>替换与之有关的规则。如果没有给出参数，这条命令将试着删除每个非内建的链。</span></span>
<span class="line"><span>-X 删除指定表中用户自定义的规则链（delete-chain）</span></span>
<span class="line"><span>-P 设置指定链的默认策略（policy）</span></span>
<span class="line"><span>-Z 将所有表的所有链的字节和数据包计数器清零，可以和 -L配合使用，在清空前察看计数器</span></span>
<span class="line"><span>-n 使用数字形式（numeric）显示输出结果</span></span>
<span class="line"><span>-v 查看规则表详细信息（verbose）的信息</span></span>
<span class="line"><span>-V 查看版本(version)</span></span>
<span class="line"><span>-h 获取帮助（help）</span></span>
<span class="line"><span>-p 规则或者包检查(待检查包)的协议。指定协议可以是tcp、udp、icmp中的一个或者全部，也可以是数值，代表这些</span></span>
<span class="line"><span>协议中的某一个。当然也可以使用在/etc/protocols中定义的协议名。在协议名前加上&quot;!&quot;表示相反的规则。数字0相当</span></span>
<span class="line"><span>于所有all。Protocol all会匹配所有协议，而且这是缺省时的选项。在和check命令结合时，all可以不被使用。</span></span>
<span class="line"><span>-s 指定源地址，可以是主机名、网络名和清楚的IP地址。mask说明可以是网络掩码或清楚的数字，在网络掩码的左边指</span></span>
<span class="line"><span>定网络掩码左边&quot;1&quot;的个数，因此，mask值为24等于255.255.255.0。在指定地址前加上&quot;!&quot;说明指定了相反的地址段。</span></span>
<span class="line"><span>标志 --src 是这个选项的简写。</span></span>
<span class="line"><span>-d 指定目标地址，要获取详细说明请参见 -s标志的说明。标志 --dst 是这个选项的简写</span></span>
<span class="line"><span>-j 目标跳转，指定规则的目标；也就是说，如果包匹配应当做什么。目标可以是用户自定义链（不是这条规则所在的），</span></span>
<span class="line"><span>某个会立即决定包的命运的专用内建目标，或者一个扩展（参见下面的EXTENSIONS）。如果规则的这个选项被忽略，那</span></span>
<span class="line"><span>么匹配的过程不会对包产生影响，不过规则的计数器会增加。</span></span>
<span class="line"><span>-i 这是包经由该接口接收的可选的入口名称，包通过该接口接收（在链INPUT、FORWORD和PREROUTING中进入的包）。</span></span>
<span class="line"><span>当在接口名前使用&quot;!&quot;说明后，指的是相反的名称。如果接口名后面加上&quot;+&quot;，则所有以此接口名开头的接口都会被匹配。</span></span>
<span class="line"><span>如果这个选项被忽略，会假设为&quot;+&quot;，那么将匹配任意接口。</span></span>
<span class="line"><span>-o 这是包经由该接口送出的可选的出口名称，包通过该口输出（在链FORWARD、OUTPUT和POSTROUTING中送出的包）。</span></span>
<span class="line"><span>当在接口名前使用&quot;!&quot;说明后，指的是相反的名称。如果接口名后面加上&quot;+&quot;，则所有以此接口名开头的接口都会被匹配。</span></span>
<span class="line"><span>如果这个选项被忽略，会假设为&quot;+&quot;，那么将匹配所有任意接口。</span></span>
<span class="line"><span>[!] -f, 这意味着在分片的包中，规则只询问第二及以后的片。自那以后由于无法判断这种把包的源端口或目标端口（或</span></span>
<span class="line"><span>者是ICMP类型的），这类包将不能匹配任何指定对他们进行匹配的规则。如果&quot;!&quot;说明用在了&quot;-f&quot;标志之前，表示相反的</span></span>
<span class="line"><span>意思。</span></span>
<span class="line"><span>其他选项</span></span>
<span class="line"><span> 还可以指定下列附加选项：</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>-v 详细输出。这个选项让list命令显示接口地址、规则选项（如果有）和TOS（Type of Service）掩码。包和字节</span></span>
<span class="line"><span>计数器也将被显示，分别用K、M、G(前缀)表示1000、1,000,000和1,000,000,000倍（不过请参看-x标志改变它），</span></span>
<span class="line"><span>对于添加,插入,删除和替换命令，这会使一个或多个规则的相关详细信息被打印。</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>-n 数字输出。IP地址和端口会以数字的形式打印。默认情况下，程序试显示主机名、网络名或者服务（只要可用）。</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>-x 精确扩展数字。显示包和字节计数器的精确值，代替用K,M,G表示的约数。这个选项仅能用于 -L 命令。</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>--line-numbers 当列表显示规则时，在每个规则的前面加上行号，与该规则在链中的位置相对应。</span></span>
<span class="line"><span> </span></span>
<span class="line"><span> </span></span>
<span class="line"><span># 目标动作</span></span>
<span class="line"><span>ACCEPT 允许数据包通过</span></span>
<span class="line"><span>DROP   直接丢弃数据包，不给任何回应信息</span></span>
<span class="line"><span>REJECT 拒绝数据包通过，必要时会给数据发送端一个响应的信息。</span></span>
<span class="line"><span>LOG    在/var/log/messages文件中记录日志信息，然后将数据包传递给下一条规则</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>iptables能够使用一些与模块匹配的扩展包。以下就是含于基本包内的扩展包，而且他们大多数都可以通过在前面加上!来表示相反的意思</p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>tcp</span></span>
<span class="line"><span></span></span>
<span class="line"><span>当 --protocol tcp 被指定,且其他匹配的扩展未被指定时,这些扩展被装载。它提供以下选项：</span></span>
<span class="line"><span></span></span>
<span class="line"><span>--source-port [!] [port[:port]]</span></span>
<span class="line"><span>源端口或端口范围指定。这可以是服务名或端口号。使用格式端口：端口也可以指定包含的（端口）范围。</span></span>
<span class="line"><span>如果首端口号被忽略，默认是&quot;0&quot;，如果末端口号被忽略，默认是&quot;65535&quot;，如果第二个端口号大于第一个，</span></span>
<span class="line"><span>那么它们会被交换。这个选项可以使用 --sport的别名。</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>--destionation-port [!] [port:[port]]</span></span>
<span class="line"><span>目标端口或端口范围指定。这个选项可以使用 --dport别名来代替。</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>--tcp-flags [!] mask comp</span></span>
<span class="line"><span>匹配指定的TCP标记。第一个参数是我们要检查的标记，一个用逗号分开的列表，第二个参数是用逗号分开</span></span>
<span class="line"><span>的标记表,是必须被设置的。标记如下：SYN ACK FIN RST URG PSH ALL NONE。因此这条命令：</span></span>
<span class="line"><span>iptables -A FORWARD -p tcp --tcp-flags SYN, ACK, FIN, RST SYN只匹配那些SYN标记被设置而ACK、FIN和RST标记没有设置的包。</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>[!] --syn</span></span>
<span class="line"><span>只匹配那些设置了SYN位而清除了ACK和FIN位的TCP包。这些包用于TCP连接初始化时发出请求；例如，</span></span>
<span class="line"><span>大量的这种包进入一个接口发生堵塞时会阻止进入的TCP连接，而出去的TCP连接不会受到影响。</span></span>
<span class="line"><span>这等于 --tcp-flags SYN, RST, ACK SYN。如果&quot;--syn&quot;前面有&quot;!&quot;标记，表示相反的意思。</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>--tcp-option [!] number</span></span>
<span class="line"><span>匹配设置了TCP选项的。</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>udp</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>当protocol udp 被指定,且其他匹配的扩展未被指定时,这些扩展被装载,它提供以下选项：</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>--source-port [!] [port:[port]]</span></span>
<span class="line"><span>源端口或端口范围指定。详见 TCP扩展的--source-port选项说明。</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>--destination-port [!] [port:[port]]</span></span>
<span class="line"><span>目标端口或端口范围指定。详见 TCP扩展的--destination-port选项说明。</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>multiport</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>这个模块匹配一组源端口或目标端口,最多可以指定15个端口。只能和-p tcp 或者 -p udp 连着使用。</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>--source-port [port[, port]]</span></span>
<span class="line"><span>如果源端口是其中一个给定端口则匹配</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>--destination-port [port[, port]]</span></span>
<span class="line"><span>如果目标端口是其中一个给定端口则匹配</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>--port [port[, port]]</span></span>
<span class="line"><span>若源端口和目的端口相等并与某个给定端口相等,则匹配。</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>limit</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>这个模块匹配标志用一个标记桶过滤器一一定速度进行匹配,它和LOG目标结合使用来给出有限的登陆数.当达到这个极限值时,</span></span>
<span class="line"><span>使用这个扩展包的规则将进行匹配.(除非使用了&quot;!&quot;标记)</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>--limit rate</span></span>
<span class="line"><span>最大平均匹配速率：可赋的值有&#39;/second&#39;, &#39;/minute&#39;, &#39;/hour&#39;, or &#39;/day&#39;这样的单位，默认是3/hour。</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>--limit-burst number</span></span>
<span class="line"><span>待匹配包初始个数的最大值:若前面指定的极限还没达到这个数值,则概数字加1.默认值为5</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>mac</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>--mac-source [!] address</span></span>
<span class="line"><span>匹配物理地址。必须是XX:XX:XX:XX:XX这样的格式。注意它只对来自以太设备并进入PREROUTING、FORWORD和INPUT链的包有效。</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>icmp</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>当protocol icmp被指定,且其他匹配的扩展未被指定时,该扩展被装载。它提供以下选项：</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>--icmp-type [!] typename</span></span>
<span class="line"><span>这个选项允许指定ICMP类型，可以是一个数值型的ICMP类型，或者是某个由命令iptables -p icmp -h所显示的ICMP类型名。</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>SNAT 这个目标只适用于nat表的POSTROUTING链。它规定修改包的源地址（此连接以后所有的包都会被影响），停止对规则的检查，</span></span>
<span class="line"><span>它包含选项：</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>--to-source [-][:port-port] 可以指定一个单一的新的IP地址，一个IP地址范围，也可以附加一个端口范围（只能在指定-p tcp </span></span>
<span class="line"><span>或者-p udp的规则里）。如果未指定端口范围，源端口中512以下的（端口）会被安置为其他的512以下的端口；512到1024之间的端口</span></span>
<span class="line"><span>会被安置为1024以下的，其他端口会被安置为1024或以上。如果可能，端口不会被修改。</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>--to-destiontion [-][:port-port] 可以指定一个单一的新的IP地址，一个IP地址范围，也可以附加一个端口范围（只能在指定-p tcp </span></span>
<span class="line"><span>或者-p udp的规则里）。如果未指定端口范围，目标端口不会被修改。</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>MASQUERADE 只用于nat表的POSTROUTING链。只能用于动态获取IP（拨号）连接：如果你拥有静态IP地址，你要用SNAT。伪装相当于</span></span>
<span class="line"><span>给包发出时所经过接口的IP地址设置一个映像，当接口关闭连接会终止。这是因为当下一次拨号时未必是相同的接口地址（以后所有建立</span></span>
<span class="line"><span>的连接都将关闭）。它有一个选项：</span></span>
<span class="line"><span></span></span>
<span class="line"><span>--to-ports [-port&gt;] 指定使用的源端口范围，覆盖默认的SNAT源地址选择（见上面）。这个选项只适用于指定了-p tcp或者-p udp的规则。</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>REDIRECT 只适用于nat表的PREROUTING和OUTPUT链，和只调用它们的用户自定义链。它修改包的目标IP地址来发送包到机器自身</span></span>
<span class="line"><span>（本地生成的包被安置为地址127.0.0.1）。它包含一个选项：</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>--to-ports [ ] 指定使用的目的端口或端口范围：不指定的话，目标端口不会被修改。只能用于指定了-p tcp 或 -p udp的规则。</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>DIAGNOSTICS 诊断。不同的错误信息会打印成标准错误：退出代码0表示正确。类似于不对的或者滥用的命令行参数错误会返回错误代码2，</span></span>
<span class="line"><span>其他错误返回代码为1。</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>COMPATIBILITY WITH IPCHAINS  与ipchains的兼容性。iptables和Rusty Russell的ipchains非常相似。主要区别是INPUT </span></span>
<span class="line"><span>链只用于进入本地主机的包,而OUTPUT只用于自本地主机生成的包。因此每个包只经过三个链的一个；以前转发的包会经过所有三个链。</span></span>
<span class="line"><span>其他主要区别是 -i 引用进入接口；-o引用输出接口，两者都适用于进入FORWARD链的包。当和可选扩展模块一起使用默认过滤器表时，</span></span>
<span class="line"><span>iptables是一个纯粹的包过滤器。这能大大减少以前对IP伪装和包过滤结合使用的混淆，所以以下选项作了不同的处理：</span></span>
<span class="line"><span>-j MASQ</span></span>
<span class="line"><span>-M -S</span></span>
<span class="line"><span>-M -L</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>TOS 用来设置IP包的首部八位tos。只能用于mangle表。</span></span>
<span class="line"><span>--set-tos tos 你可以使用一个数值型的TOS 值，或者用iptables -j TOS -h 来查看有效TOS名列表</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>MARK 用来设置包的netfilter标记值。只适用于mangle表。</span></span>
<span class="line"><span>--set-mark mark</span></span>
<span class="line"><span>REJECT 作为对匹配的包的响应，返回一个错误的包：其他情况下和DROP相同。此目标只适用于INPUT、FORWARD和OUTPUT链，和调用</span></span>
<span class="line"><span>这些链的用户自定义链。这几个选项控制返回的错误包的特性：</span></span>
<span class="line"><span>--reject-with type </span></span>
<span class="line"><span>Type可以是icmp-net-unreachable、icmp-host-unreachable、icmp-port-nreachable、icmp-proto-unreachable、 </span></span>
<span class="line"><span>icmp-net-prohibited 或者 icmp-host-prohibited，该类型会返回相应的ICMP错误信息（默认是port-unreachable）。选项 </span></span>
<span class="line"><span>echo-reply也是允许的；它只能用于指定ICMP ping包的规则中，生成ping的回应。最后，选项tcp-reset可以用于在INPUT链中,或</span></span>
<span class="line"><span>自INPUT链调用的规则，只匹配TCP协议：将回应一个TCP RST包。</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>LOG 为匹配的包开启内核记录。当在规则中设置了这一选项后，linux内核会通过printk()打印一些关于全部匹配包的信息（诸如IP包头字段等）。</span></span>
<span class="line"><span>--log-level level</span></span>
<span class="line"><span>记录级别（数字或参看 syslog.conf(5)）。</span></span>
<span class="line"><span>--log-prefix prefix</span></span>
<span class="line"><span>在纪录信息前加上特定的前缀：最多14个字母长，用来和记录中其他信息区别。</span></span>
<span class="line"><span>--log-tcp-sequence</span></span>
<span class="line"><span>记录TCP序列号。如果记录能被用户读取那么这将存在安全隐患。</span></span>
<span class="line"><span>--log-tcp-options</span></span>
<span class="line"><span>记录来自TCP包头部的选项。</span></span>
<span class="line"><span>--log-ip-options</span></span>
<span class="line"><span>记录来自IP包头部的选项。</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>tos 此模块匹配IP包首部的8位tos（服务类型）字段（也就是说，包含在优先位中）。</span></span>
<span class="line"><span>--tos tos</span></span>
<span class="line"><span>这个参数可以是一个标准名称，（用iptables -m tos -h 察看该列表），或者数值。</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>state 此模块，当与连接跟踪结合使用时，允许访问包的连接跟踪状态。</span></span>
<span class="line"><span>--state state</span></span>
<span class="line"><span>这里state是一个逗号分割的匹配连接状态列表。可能的状态是:INVALID表示包是未知连接，ESTABLISHED表示是双向传送的连接，</span></span>
<span class="line"><span>NEW表示包为新的连接，否则是非双向传送的，而RELATED表示包由新连接开始，但是和一个已存在的连接在一起，如FTP数据传送，</span></span>
<span class="line"><span>或者一个ICMP错误。</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span> </span></span>
<span class="line"><span>owner 此模块试为本地生成包匹配包创建者的不同特征。只能用于OUTPUT链，而且即使这样一些包（如ICMP ping应答）还可能没</span></span>
<span class="line"><span>有所有者，因此永远不会匹配。</span></span>
<span class="line"><span>--uid-owner userid：如果给出有效的user id，那么匹配它的进程产生的包。</span></span>
<span class="line"><span>--gid-owner groupid：如果给出有效的group id，那么匹配它的进程产生的包。</span></span>
<span class="line"><span>--sid-owner seessionid：根据给出的会话组匹配该进程产生的包。</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>mark 这个模块和与netfilter过滤器标记字段匹配（就可以在下面设置为使用MARK标记）。</span></span>
<span class="line"><span>--mark value [/mask]：匹配那些无符号标记值的包（如果指定mask，在比较之前会给掩码加上逻辑的标记）。</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>MIRROR 这是一个试验示范目标，可用于转换IP首部字段中的源地址和目标地址，再传送该包,并只适用于INPUT、FORWARD和OUTPUT链，</span></span>
<span class="line"><span>以及只调用它们的用户自定义链。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>示例</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#1、查看filter表的iptables规则，包括所有的链。filter表包含INPUT、OUTPUT、FORWARD三个规则链</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#说明：-L是--list的简写，作用是列出规则。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -L</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#2、只查看某个表的中的规则。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#iptables -L [-t 表名]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 说明：表名一共有三个：filter,nat,mangle，如果没有指定表名，则默认查看filter表的规则列表（就相当于第一条命令）。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -L</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nat</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -L</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> raw</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#3、iptables -L [-t 表名] [链名]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#这里多了个链名，就是规则链的名称。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 说明：iptables一共有INPUT、OUTPUT、FORWARD、PREROUTING、POSTROUTING五个规则链。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 注意：链名必须大写。在Linux系统上，命令的大小写很敏感。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -L</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#4、说明：以数字形式显示规则。如果没有-n，规则中可能会出现anywhere，有了-n，它会变成0.0.0.0/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -L</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#5、说明：你也可以使用“iptables -L -nv”来查看，这个列表看起来更详细，对技术人员更友好</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -nvL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="规则设置" tabindex="-1"><a class="header-anchor" href="#规则设置"><span>规则设置</span></a></h2><h3 id="添加常用策略" tabindex="-1"><a class="header-anchor" href="#添加常用策略"><span>添加常用策略</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#1.拒绝进入防火墙的所有ICMP协议数据包</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> icmp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> REJECT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#2.允许防火墙转发除ICMP协议以外的所有数据包</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> FORWARD</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> !</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> icmp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ACCEPT</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  #说明：使用“！”可以将条件取反。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#3.拒绝转发来自192.168.1.10主机的数据，允许转发来自192.168.0.0/24网段的数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> FORWARD</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 192.168.1.11</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> REJECT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> FORWARD</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 192.168.0.0/24</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ACCEPT</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 说明：注意要把拒绝的放在前面不然就不起作用了啊。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#4.丢弃从外网接口（eth1）进入防火墙本机的源地址为私网地址的数据包</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> eth1</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 192.168.0.0/16</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DROP</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> eth1</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 172.16.0.0/12</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DROP</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> eth1</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 10.0.0.0/8</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DROP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#5.封堵网段（192.168.1.0/24），两小时后解封。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 10.20.30.0/24</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DROP</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> FORWARD</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 10.20.30.0/24</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DROP</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">at</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> now</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> hours</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">t</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> FORWARD</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 说明：这个策略咱们借助crond计划任务来完成，就再好不过了。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#[1]   Stopped     at now 2 hours</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#6.只允许管理员从202.13.0.0/16网段使用SSH远程登录防火墙主机。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --dport</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 22</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 202.13.0.0/16</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ACCEPT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --dport</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 22</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DROP</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 说明：这个用法比较适合对设备进行远程管理时使用，比如位于分公司中的SQL服务器需要被总公司的管理员管理时。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#7.允许本机开放从TCP端口20-1024提供的应用服务。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --dport</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 20:1024</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ACCEPT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> OUTPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --sport</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 20:1024</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ACCEPT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#8.允许转发来自192.168.0.0/24局域网段的DNS解析请求数据包。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> FORWARD</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 192.168.0.0/24</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> udp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --dport</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 53</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ACCEPT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> FORWARD</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 192.168.0.0/24</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> udp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --sport</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 53</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ACCEPT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#9.禁止其他主机ping防火墙主机，但是允许从防火墙上ping其他主机</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> icmp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --icmp-type</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Echo-Request</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DROP</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> icmp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --icmp-type</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Echo-Reply</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ACCEPT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> icmp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --icmp-type</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> destination-Unreachable</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ACCEPT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#10.禁止转发来自MAC地址为00：0C：29：27：55：3F的和主机的数据包</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> FORWARD</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mac</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --mac-source</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 00:0c:29:27:55:3F</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DROP</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 说明：iptables中使用“-m 模块关键字”的形式调用显示匹配。咱们这里用“-m mac –mac-source”来表示数据包的源MAC地址。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#11.允许防火墙本机对外开放TCP端口20、21、25、110以及被动模式FTP端口1250-1280</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> multiport</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --dport</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 20,21,25,110,1250:1280</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ACCEPT</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 说明：这里用“-m multiport –dport”来指定目的端口及范围</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#12.禁止转发源IP地址为192.168.1.20-192.168.1.99的TCP数据包。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> FORWARD</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> iprange</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --src-range</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 192.168.1.20-192.168.1.99</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DROP</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 说明：此处用“-m –iprange –src-range”指定IP范围。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#13.禁止转发与正常TCP连接无关的非—syn请求数据包。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> FORWARD</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> state</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --state</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> NEW</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tcp</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> !</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --syn</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DROP</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 说明：“-m state”表示数据包的连接状态，“NEW”表示与任何连接无关的，新的嘛！</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#14.拒绝访问防火墙的新数据包，但允许响应连接或与已有连接相关的数据包</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> state</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --state</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> NEW</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DROP</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> state</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --state</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ESTABLISHED,RELATED</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ACCEPT</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 说明：“ESTABLISHED”表示已经响应请求或者已经建立连接的数据包，“RELATED”表示与已建立的连接有相关性的，比如FTP数据连接等。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#15.只开放本机的web服务（80）、FTP(20、21、20450-20480)，放行外部主机发住服务器其它端口的应答数据包，将其他入站数据包均予以丢弃处理。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> multiport</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --dport</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 20,21,80</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ACCEPT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --dport</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 20450:20480</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ACCEPT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> state</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --state</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ESTABLISHED</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ACCEPT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -P</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DROP</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="删除iptables规则" tabindex="-1"><a class="header-anchor" href="#删除iptables规则"><span>删除iptables规则</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 删除用-D参数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 删除之前添加的规则（iptables -A INPUT -s 192.168.1.5 -j DROP）：</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 192.168.1.5</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DROP</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>有时候要删除的规则太长，删除时要写一大串，既浪费时间又容易写错，这时可以先使用–line-number找出该条规则的行号，再通过行号删除规则。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -nL</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --line-number</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#删除第二行规则</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -F</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        #清除预设表filter中的所有规则链的规则</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -X</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        #清除预设表filter中使用者自定链中的规则</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="修改iptables规则" tabindex="-1"><a class="header-anchor" href="#修改iptables规则"><span>修改iptables规则</span></a></h3><p>修改表中规则使用-R参数，修改链名用-E参数</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -nL</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --line-number</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> INPUT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ACCEPT</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 用新的链名取代旧的链名</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -E</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> old-chain-name</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> new-chain-name</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="防火墙规则的保存与恢复" tabindex="-1"><a class="header-anchor" href="#防火墙规则的保存与恢复"><span>防火墙规则的保存与恢复</span></a></h3><p>iptables-save把规则保存到文件中，再由目录rc.d下的脚本（/etc/rc.d/init.d/iptables）自动装载</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 使用命令iptables-save来保存规则，生成保存规则的文件 /etc/sysconfig/iptables</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">iptables-save</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/sysconfig/iptables</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 也可以用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">service</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> iptables</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> save</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  # 它能把规则自动保存在/etc/sysconfig/iptables中</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 当计算机启动时，rc.d下的脚本将用命令iptables-restore调用这个文件，从而就自动恢复了规则</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><!----></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: chriswoodcn@aliyun.com">chriswoodcn</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/zh/posts/linux/crontab%E5%91%BD%E4%BB%A4.html" aria-label="crontab命令"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->crontab命令</div></a><a class="route-link auto-link next" href="/zh/posts/linux/Linux%E4%B8%8Assh%E8%AF%81%E4%B9%A6%E7%99%BB%E5%BD%95%E9%85%8D%E7%BD%AE.html" aria-label="Linux上ssh证书登录配置"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">Linux上ssh证书登录配置<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright"><div>Copyright &copy; 2024 Chris Wood, All Rights Reserved.<div></div></footer></div><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BzNy2ypN.js" defer></script>
  </body>
</html>
